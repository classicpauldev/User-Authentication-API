Refactored authentication code for better scalability
